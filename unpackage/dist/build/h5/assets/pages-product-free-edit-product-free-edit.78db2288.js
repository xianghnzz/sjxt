import{r as e,t,aa as l,af as s,ag as r,ah as o,o as i,c as a,w as n,e as c,a as d,b as u,u as p,d as f,l as _,m as g,F as h,v as x,n as m,s as y,y as b,h as v,i as w,g as j,j as k,_ as I,p as $,Z as C}from"./index-855f89f9.js";import{_ as O}from"./tui-modal.dd985726.js";import{a as T,o as N,b as S,r as J}from"./uni-app.es.8f4863ce.js";import{_ as P}from"./back_bai.3f7a0c49.js";import{_ as F,a as E}from"./add.95838ac7.js";import{_ as B}from"./gg.7b849707.js";import{_ as L}from"./_plugin-vue_export-helper.1b428a4d.js";const M=L({__name:"product-free-edit",setup(L){const M=e({triggered:!1,product_print_list:[],bili:1,showModal:0,configsInfo:{},configsInfo2:{configs_value:""},cItem:{},cIndex:0}),{triggered:z,product_print_list:U,bili:q,showModal:H,configsInfo:A,configsInfo2:G,cItem:Z,cIndex:D}=t(M),K=l((()=>y.state.userInfo)),Q=l((()=>y.state.orderFrom)),R=l((()=>{var e,t;return 1==(null==(t=null==(e=Q.value)?void 0:e.order_commodity_info_obj)?void 0:t.commodity_print)?1:0})),V=l((()=>{let e=0;return M.product_print_list.forEach((t=>{e+=t.pages_content.imgList.reduce(((e,t)=>"photo"==t.type?e+1:e),0)})),e})),W=l((()=>{let e=0;return M.product_print_list.forEach((t=>{e+=t.pages_content.imgList.reduce(((e,t)=>"photo"==t.type&&t.url?e+1:e),0)})),e})),X=l((()=>{var e,t,l,s;const r=(null==(t=null==(e=Q.value)?void 0:e.order_spec_info_obj)?void 0:t.spec_number)||0,o=(null==(s=null==(l=Q.value)?void 0:l.order_spec_info_obj)?void 0:s.spec_multiple)||1;return M.product_print_list.length>=100||(0==r||M.product_print_list.length>=r&&M.product_print_list.length%o==0)})),Y=()=>{if(Q.value.order_id>0){if(Q.value.order_status>0)return void f.showToast("该订单已经定稿，不能修改");ee()}else te()},ee=()=>{var e;const t=JSON.parse(JSON.stringify(Q.value)),l=[M.coverPage,...M.product_print_list,M.endPage];t.order_product_info_obj.product_print=JSON.stringify(l),t.order_product_info=JSON.stringify(t.order_product_info_obj),t.order_cover=(null==(e=t.order_spec_info_obj)?void 0:e.spec_cover)||"",t.order_custom_id=K.value.custom_id,t.order_frequency=Number(t.order_frequency)+1,c.updateOrder(t).then((e=>{M.showModal=0,f.showToast("提交成功"),setTimeout((()=>{f.reToPage("home")}),1800)}))},te=()=>{var e;const t=JSON.parse(JSON.stringify(Q.value));t.order_product_info_obj.product_print=JSON.stringify(M.product_print_list),t.order_product_info=JSON.stringify(t.order_product_info_obj),t.order_cover=(null==(e=t.order_spec_info_obj)?void 0:e.spec_cover)||"",t.order_custom_id=K.value.custom_id,c.addOrder(t).then((e=>{M.showModal=0,f.showToast("提交成功"),setTimeout((()=>{f.reToPage("home")}),1800)}))},le=()=>{V.value,W.value,b({count:9,sizeType:["original","compressed"],sourceType:["album"],success:async e=>{for(let t=0;t<e.tempFilePaths.length;t++){const l=await c.uploadFile({filePath:e.tempFilePaths[t],name:"file"});se(l.data.url),console.log("res2.data.url",l.data.url)}}})},se=e=>{for(let t of M.product_print_list){let l=0;for(let s of t.pages_content.imgList)if("photo"==s.type&&""==s.url){s.url=e,l=1;break}if(1==l)break}};return T((()=>{})),N((e=>{var t,l;if(c.getConfigsById({configs_id:102}).then((e=>{M.configsInfo=e.data})),c.getConfigsById({configs_id:101}).then((e=>{M.configsInfo2=e.data})),null==(l=null==(t=Q.value)?void 0:t.order_product_info_obj)?void 0:l.product_print){if(M.product_print_list=JSON.parse(Q.value.order_product_info_obj.product_print),M.product_print_list.length>0){const e=s(344);M.product_print_list.forEach((t=>{t.bili=t.pages_area_width/e}))}}else M.product_print_list=[];r("updatePageInfo",(e=>{(e=>{const t=s(344);e.bili=e.pages_area_width/t,M.product_print_list[M.cIndex]=Object.assign({},e)})(e)}))})),S((()=>{o("updatePageInfo")})),(e,t)=>{const l=v,s=w,r=j,o=J(k("tui-modal"),O),y=J(k("page"),I);return i(),a(y,{bgColor:"#fff",topColor:"#00AEEF",topHeight:88,bottomHeight:240,refresherEnabled:!1},{navBar:n((()=>[d(r,{class:"text-center flex align-center justify-center",style:{height:"88rpx"}},{default:n((()=>[d(l,{class:"font-36 text-white"},{default:n((()=>[u("无限模式商品模版编辑")])),_:1}),d(r,{onClick:t[0]||(t[0]=e=>p(f).goBack()),class:"position-absolute rounded-circle flex align-center justify-center",style:{width:"40rpx",height:"32rpx",left:"32rpx"}},{default:n((()=>[d(s,{style:{width:"40rpx",height:"32rpx"},src:P,mode:""})])),_:1})])),_:1})])),content:n((()=>[d(r,{class:"px-1 py-2 flex flex-wrap"},{default:n((()=>[(i(!0),_(h,null,g(p(U),((e,t)=>(i(),a(r,{key:t,class:"m-1",style:{width:"344rpx"}},{default:n((()=>[d(r,{onClick:l=>((e,t)=>{var l,s,r,o;if(M.cItem=e,M.cIndex=t,1==((null==(s=null==(l=Q.value)?void 0:l.order_spec_info_obj)?void 0:s.spec_edit)||0)){const e=(null==(o=null==(r=Q.value)?void 0:r.order_spec_info_obj)?void 0:o.spec_template_edit_mode)||0;1==e?f.goToPage("easy-edit",`pageInfo=${JSON.stringify(M.cItem)}`):2==e?f.goToPage("professional-edit",`pageInfo=${JSON.stringify(M.cItem)}`):f.showToast("所选页面只允许换图片")}else f.showToast("该模版只允许换图片")})(e,t),class:"position-relative flex align-center justify-center",style:{width:"344rpx"}},{default:n((()=>{var o;return[(null==(o=null==e?void 0:e.pages_content)?void 0:o.bgImg)?(i(),a(s,{key:0,class:"border",style:{width:"344rpx"},src:p(f).showImageUrl(e.pages_content.bgImg),mode:"widthFix"},null,8,["src"])):$("",!0),d(r,{class:"position-absolute top-0 left-0 right-0 bottom-0"},{default:n((()=>[(i(!0),_(h,null,g(e.pages_content.imgList,((o,_)=>(i(),a(r,{key:_,class:""},{default:n((()=>["photo"==o.type?(i(),a(r,{key:0,onClick:C((e=>{return l=t,s=_,void b({count:1,sizeType:["original","compressed"],sourceType:["album"],success:e=>{const t=e.tempFilePaths[0];c.uploadFile({filePath:t,name:"file"}).then((e=>{M.product_print_list[l].pages_content.imgList[s].url=e.data.url}))}});var l,s}),["stop"]),class:"position-absolute border border-primary flex align-center justify-center overflow-hidden",style:m([{"background-color":"rgba(51, 102, 255, 0.2)"},`transform:scale(${o.scale}) rotate(${e.r||0}deg);border-radius: ${e.radius}px;top:${o.y/e.bili}px;left:${o.x/e.bili}px;width: ${o.width/e.bili}px; height:${o.height/e.bili}px;`])},{default:n((()=>[o.url?(i(),a(s,{key:0,style:m(`width: ${o.width/e.bili}px; height:${o.height/e.bili}px;`),src:p(f).showImageUrl(o.url),mode:"widthFix"},null,8,["style","src"])):(i(),a(l,{key:1,class:"text-primary font-40 font-weight-bold"},{default:n((()=>[u("+")])),_:1}))])),_:2},1032,["onClick","style"])):(i(),a(r,{key:1,class:"position-absolute"},{default:n((()=>[d(s,{class:"position-absolute",style:m(`transform:scale(${o.scale}) rotate(${e.r||0}deg);border-radius: ${e.radius}px;top:${o.y/e.bili}px;left:${o.x/e.bili}px;width: ${o.width/e.bili}px; height:${o.height/e.bili}px;`),src:p(f).showImageUrl(o.url),mode:""},null,8,["style","src"])])),_:2},1024))])),_:2},1024)))),128))])),_:2},1024),1==p(R)&&(t+1)%2==0?(i(),a(r,{key:1,class:"bg-opacity p-1 position-absolute right-0 top-0 flex align-center justify-center rounded-circle",style:{width:"60rpx",height:"30rpx"}},{default:n((()=>[d(l,{class:"font-20 text-white"},{default:n((()=>[u("反面")])),_:1})])),_:1})):$("",!0)]})),_:2},1032,["onClick"]),d(r,{class:"flex align-center justify-center py-2 font-30 font-weight-bold"},{default:n((()=>[d(s,{onClick:e=>(e=>{if(1==M.product_print_list.length)return f.showToast("只剩最后一页了，不能移除了！！！"),!1;M.product_print_list.splice(e,1)})(t),style:{width:"50rpx",height:"50rpx"},src:F,mode:""},null,8,["onClick"]),d(l,{class:"ml-2"},{default:n((()=>{var e,t;return[u(x(null==(t=null==(e=p(Q))?void 0:e.order_spec_info_obj)?void 0:t.spec_page_prefix),1)]})),_:1}),d(l,{class:"mx-1"},{default:n((()=>[u(x(t+1),1)])),_:2},1024),d(l,{class:"mr-2"},{default:n((()=>{var e,t;return[u(x(null==(t=null==(e=p(Q))?void 0:e.order_spec_info_obj)?void 0:t.spec_page_suffix),1)]})),_:1}),d(s,{onClick:t=>(e=>{const t=JSON.parse(JSON.stringify(e));t.pages_id=Math.random().toString(16).slice(2),M.product_print_list.push(t)})(e),style:{width:"50rpx",height:"50rpx"},src:E,mode:""},null,8,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1}),d(o,{show:1==p(H),custom:""},{default:n((()=>[d(r,{class:"rounded-20 bg-white border-box font pb-3",style:{width:"600rpx"}},{default:n((()=>[d(r,{class:"py-2 text-center"},{default:n((()=>[d(l,{class:"font-40 font-weight-bold"},{default:n((()=>[u("产品信息确认")])),_:1})])),_:1}),d(r,{class:"py-2 px-4 font-32"},{default:n((()=>[d(r,{class:"flex align-center py-1"},{default:n((()=>[d(r,{class:""},{default:n((()=>[d(l,{class:"text-color-999"},{default:n((()=>[u("产品：")])),_:1})])),_:1}),d(r,{class:"flex text-ellipsis"},{default:n((()=>[d(l,{class:"font-weight-bold"},{default:n((()=>{var e;return[u(x(null==(e=p(Q))?void 0:e.order_commodity_name),1)]})),_:1})])),_:1})])),_:1}),d(r,{class:"flex align-center py-1"},{default:n((()=>[d(r,{class:""},{default:n((()=>[d(l,{class:"text-color-999"},{default:n((()=>[u("规格：")])),_:1})])),_:1}),d(r,{class:"flex text-ellipsis"},{default:n((()=>[d(l,{class:"font-weight-bold"},{default:n((()=>{var e;return[u(x(null==(e=p(Q))?void 0:e.order_spec_name),1)]})),_:1})])),_:1})])),_:1}),d(r,{class:"flex align-center py-1"},{default:n((()=>[d(r,{class:""},{default:n((()=>[d(l,{class:"text-color-999"},{default:n((()=>[u("纸张：")])),_:1})])),_:1}),d(r,{class:"flex text-ellipsis"},{default:n((()=>[d(l,{class:"font-weight-bold"},{default:n((()=>{var e;return[u(x((null==(e=p(Q))?void 0:e.order_material_name)||"系统提供纸张"),1)]})),_:1})])),_:1})])),_:1}),d(r,{class:"flex align-center py-2"},{default:n((()=>[d(s,{style:{width:"24rpx",height:"24rpx"},src:B,mode:"widthFix"}),d(r,{class:"ml-1 flex-1"},{default:n((()=>[d(l,{class:"text-warning font-24"},{default:n((()=>[u("核对产品信息，如有问题点击取消返回，核对无误点击确认")])),_:1})])),_:1})])),_:1})])),_:1}),d(r,{class:"px-5 flex align-center justify-center px-2"},{default:n((()=>[d(r,{onClick:t[1]||(t[1]=e=>H.value=0),class:"flex-1 flex align-center justify-center bg-info rounded-circle mr-2",style:{height:"80rpx"}},{default:n((()=>[d(l,{class:"text-white"},{default:n((()=>[u("取消")])),_:1})])),_:1}),d(r,{onClick:Y,class:"flex-1 flex align-center justify-center linear-gradient rounded-circle ml-2",style:{height:"80rpx"}},{default:n((()=>[d(l,{class:"text-white"},{default:n((()=>[u("确定")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])])),bottomBar:n((()=>[d(r,{class:"flex align-center justify-center text-ellipsis px-1",style:m([`background-color:${p(G).configs_content}; color:${p(G).configs_illustrate};font-size: ${p(G).configs_use||28}rpx;`,{width:"750rpx",height:"60rpx"}])},{default:n((()=>[d(l,{class:"text-ellipsis text-center"},{default:n((()=>[u(x(p(G).configs_value),1)])),_:1})])),_:1},8,["style"]),d(r,{class:"flex align-center justify-center text-ellipsis px-1",style:m([`background-color:${p(A).configs_content}; color:${p(A).configs_illustrate};font-size: ${p(A).configs_use||28}rpx;`,{width:"750rpx",height:"60rpx"}])},{default:n((()=>[d(l,{class:"text-ellipsis text-center"},{default:n((()=>{var e,t;return[u(x(null==(t=null==(e=p(Q))?void 0:e.order_spec_info_obj)?void 0:t.spec_prompt),1)]})),_:1})])),_:1},8,["style"]),d(r,{class:"bg-white flex align-center justify-center px-2",style:{height:"120rpx"}},{default:n((()=>[d(r,{onClick:le,class:"flex-1 flex align-center justify-center bg-warning rounded-circle mr-1",style:{height:"90rpx"}},{default:n((()=>[d(l,{class:"text-white"},{default:n((()=>[u("上传图片("+x(p(W))+"/"+x(p(V))+")",1)])),_:1})])),_:1}),p(X)?(i(),a(r,{key:0,onClick:t[2]||(t[2]=e=>H.value=1),class:"flex-1 flex align-center justify-center linear-gradient rounded-circle ml-1",style:{height:"90rpx"}},{default:n((()=>[d(l,{class:"text-white"},{default:n((()=>[u("制作完成")])),_:1})])),_:1})):(i(),a(r,{key:1,onClick:t[3]||(t[3]=e=>H.value=1),class:"flex-1 flex align-center justify-center bg-info rounded-circle ml-1",style:{height:"90rpx"}},{default:n((()=>[d(l,{class:"text-white"},{default:n((()=>[u("未达定制倍数")])),_:1})])),_:1}))])),_:1})])),_:1})}}},[["__scopeId","data-v-2bfc8bd2"]]);export{M as default};
